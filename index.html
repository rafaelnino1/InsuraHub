<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no"/>
  <title>InsuraHub App</title>

  <!-- PWA meta -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#3498db">
  <link rel="apple-touch-icon" href="icons/icon-192.png">

  <!-- Iconos / fuentes -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    /* ===== Variables / base ===== */
    :root{
      --primary:#3498db; --primary-light:#5dade2; --primary-dark:#2c80b9;
      --secondary:#2ecc71; --accent:#e74c3c;
      --background:#eef4ff; --card-bg:#ffffff;
      --text-dark:#1f2d3d; --text-light:#7f8c8d;
      --success:#2ecc71; --warning:#f39c12; --danger:#e74c3c;
      --depth-1: 0 6px 14px rgba(0,0,0,.08), 0 2px 4px rgba(0,0,0,.06);
      --depth-2: 0 12px 28px rgba(0,0,0,.12), 0 4px 10px rgba(0,0,0,.08);
      --depth-3: 0 22px 50px rgba(0,0,0,.18), 0 8px 16px rgba(0,0,0,.12);
      --specular: inset 0 1px 0 rgba(255,255,255,.6);
      --ring-bg:#edf2f7;
    }
    *{margin:0;padding:0;box-sizing:border-box;font-family:'Poppins','Segoe UI',Tahoma,Geneva,Verdana,sans-serif}
    html,body{height:100%}
    body{
      color:var(--text-dark); line-height:1.6; min-height:100vh; padding:20px;
      background:
        radial-gradient(1000px 500px at 10% 0%, rgba(93,173,226,.25), transparent 60%),
        radial-gradient(900px 500px at 100% 30%, rgba(46,204,113,.18), transparent 60%),
        linear-gradient(135deg,#e6f0ff 0%, #d6ecff 40%, #cfeef0 100%);
    }
    .container{max-width:1300px;margin:0 auto}

    /* ===== Header ===== */
    header{
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      padding:22px 30px;border-radius:18px;margin-bottom:30px;
      box-shadow: var(--depth-3);
      display:flex;justify-content:space-between;align-items:center;color:white;
      position:relative;overflow:hidden;
    }
    header::before{
      content:'';position:absolute;inset:-30% -20% auto auto;width:120%;height:220%;
      background: radial-gradient(closest-side, rgba(255,255,255,.18), transparent 60%);
      transform: rotate(25deg);
    }
    .app-title{display:flex;align-items:center;gap:16px;position:relative;z-index:1}
    .app-icon{
      width:88px;height:88px;background: rgba(255,255,255,.15);border-radius:16px;
      display:flex;align-items:center;justify-content:center;color:white;font-weight:800;font-size:32px;
      backdrop-filter: blur(10px); box-shadow: var(--depth-2), var(--specular);
      border:1px solid rgba(255,255,255,.35); transition: transform .35s ease;
      overflow:hidden;
    }
    .app-icon img{
      width:88px;height:88px;object-fit:contain;display:block
    }
    .app-icon:hover{transform: translateY(-2px)}
    .app-title-text h1{font-size:28px;font-weight:800;margin-bottom:6px;letter-spacing:.2px}
    .app-title-text p{font-size:14px;opacity:.95}
    .user-actions{display:flex;gap:14px;position:relative;z-index:1}
    .btn{
      display:inline-flex;align-items:center;gap:10px;padding:12px 22px;background-color:white;color:var(--primary);
      border:none;border-radius:12px;cursor:pointer;font-weight:700;transition:transform .2s ease, box-shadow .2s ease, filter .2s ease;
      text-decoration:none;box-shadow: var(--depth-1);
    }
    .btn:hover{transform: translateY(-2px); box-shadow: var(--depth-2)}
    .btn-outline{background:transparent;border:2px solid white;color:white;box-shadow:none}
    .btn-outline:hover{background:white;color:var(--primary)}
    .btn-success{background:linear-gradient(180deg,#35d07f,#2cb56f); color:white}
    .btn-warning{background:linear-gradient(180deg,#f6b449,#e99a10); color:white}
    .btn-danger{background:linear-gradient(180deg,#ef6b61,#e0443a); color:white}
    .btn-soft{background:linear-gradient(180deg,#f7fbff,#eef6ff); color:#2c3e50; border:1px solid rgba(52,152,219,.2)}

    /* ===== Stats ===== */
    .stats-bar{
      display:flex;justify-content:space-around;background: var(--card-bg);
      border-radius:18px;padding:22px;margin-bottom:30px;box-shadow: var(--depth-2);
      background:
        linear-gradient(180deg, #ffffff 0%, #f3f8ff 100%),
        radial-gradient(120% 80% at 20% 0%, rgba(93,173,226,.10), transparent 60%);
      border:1px solid rgba(52,152,219,.12);
    }
    .stat-item{text-align:center;padding:0 20px;position:relative}
    .stat-item:not(:last-child)::after{
      content:'';position:absolute;right:0;top:18%;height:64%;width:1px;
      background: linear-gradient(to bottom, transparent, rgba(52,152,219,.35), transparent);
    }
    .stat-value{
      font-size:34px;font-weight:900;margin-bottom:6px;
      background: linear-gradient(180deg, #2c80b9, #3498db);
      -webkit-background-clip: text; background-clip: text; color: transparent;
    }
    .stat-label{color:var(--text-light);font-size:13px;font-weight:700;letter-spacing:.3px}

    /* ===== Cards ===== */
    .card-grid{display:grid;grid-template-columns: repeat(auto-fill, minmax(320px,1fr));gap:26px;margin-bottom:42px}
    .card{
      background: var(--card-bg); border-radius:18px; padding:20px;
      box-shadow: var(--depth-2); transition: transform .25s ease, box-shadow .25s ease;
      display:flex;flex-direction:column; position:relative; overflow:hidden;
      border:1px solid rgba(52,152,219,.10);
      background-image:
        radial-gradient(800px 240px at -10% 0%, rgba(93,173,226,.12), transparent 40%),
        linear-gradient(180deg, #ffffff 0%, #f7f9ff 100%);
    }
    .card:hover{transform: translateY(-3px); box-shadow: var(--depth-3)}
    .card.status-good::after, .card.status-warning::after, .card.status-danger::after{
      content:''; position:absolute; left:0; top:0; bottom:0; width:6px; box-shadow: inset 0 0 0 1px rgba(255,255,255,.25);
    }
    .card.status-good::after{background: linear-gradient(180deg, #41d98b, #2cb56f)}
    .card.status-warning::after{background: linear-gradient(180deg, #f7c052, #e99a10)}
    .card.status-danger::after{background: linear-gradient(180deg, #f07b72, #e0443a)}

    .card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px;padding-bottom:14px;border-bottom:2px solid rgba(52,152,219,.10)}
    .insurance-type{
      display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px;
      background: linear-gradient(180deg, rgba(52,152,219,.14), rgba(52,152,219,.06));
      border:1px solid rgba(52,152,219,.18);
      font-weight:900;font-size:18px;color:var(--primary-dark);letter-spacing:.2px
    }
    .insurance-icon{
      width:48px;height:48px;background: linear-gradient(180deg, var(--primary-light), var(--primary));
      border-radius:12px; display:flex;align-items:center;justify-content:center;color:white;
      box-shadow: 0 8px 16px rgba(52,152,219,.30); border:1px solid rgba(255,255,255,.4); position:relative;
    }
    .insurance-icon i{font-size:20px}
    .insurance-icon::after{
      content:''; position:absolute; inset:-4px; border-radius:12px;
      border:1px solid rgba(255,255,255,.5);
      box-shadow: inset 0 6px 12px rgba(255,255,255,.25), inset 0 -6px 12px rgba(0,0,0,.08);
      pointer-events:none;
    }

    .card-details{margin-bottom:18px;flex-grow:1}
    .detail-item{display:flex;justify-content:space-between;margin-bottom:10px}
    .detail-label{color:var(--text-light);font-size:14px}
    .detail-value{font-weight:700;color:var(--text-dark)}

    /* Logos pólizas */
    .logo-container{height:64px;display:flex;align-items:center;margin-bottom:16px;justify-content:center}
    .company-logo{max-height:64px;max-width:238px;object-fit:contain;filter: drop-shadow(0 2px 4px rgba(0,0,0,.15))}
    .logo-placeholder{width:238px;height:64px;background:#ecf0f1;border-radius:8px;display:flex;align-items:center;justify-content:center;color:#95a5a6;font-weight:800;font-size:16px;box-shadow: inset 0 1px 0 rgba(255,255,255,.7)}

    /* Teléfono de contacto */
    .contact-line{
      display:flex; align-items:center; justify-content:center;
      gap:8px; font-weight:800; color:#105b96; background:linear-gradient(180deg,#f7fbff,#eef6ff);
      border:1px solid rgba(52,152,219,.18); padding:10px 12px; border-radius:12px; margin:10px 0 6px;
      box-shadow: var(--depth-1);
    }
    .contact-line i{color:#2c80b9}

    /* Anillo 3D */
    .status-container{display:flex;flex-direction:column;align-items:center;margin:12px 0 0}
    .status-ring{
      position:relative;width:96px;height:96px;border-radius:50%;
      display:flex;align-items:center;justify-content:center;font-weight:900;font-size:16px;
      background: conic-gradient(var(--ring-color, var(--success)) 0 var(--progress, 100%), var(--ring-bg) var(--progress, 100%) 100%);
      box-shadow: 0 12px 22px rgba(0,0,0,.18), 0 6px 10px rgba(0,0,0,.10);
    }
    .status-ring::before{
      content:""; position:absolute; inset:-2px; border-radius:50%;
      background:
        radial-gradient(circle at 30% 30%, rgba(255,255,255,.85), rgba(255,255,255,.25) 40%, rgba(255,255,255,0) 60%),
        conic-gradient(from -90deg, rgba(255,255,255,.25), rgba(0,0,0,.08), rgba(255,255,255,.25));
      box-shadow: inset 0 2px 6px rgba(0,0,0,.18), inset 0 -2px 6px rgba(0,0,0,.08);
      z-index:0;
    }
    .status-ring::after{
      content:""; position:absolute; inset:8px; border-radius:50%;
      background: radial-gradient( circle at 35% 30%, #ffffff, #f5f8ff 60%, #e9eef7 100%);
      box-shadow: inset 0 4px 10px rgba(0,0,0,.10), inset 0 -3px 8px rgba(0,0,0,.08);
      z-index:1;
    }
    .status-ring-inner{
      position:relative; z-index:2; width:72px;height:72px;border-radius:50%;
      display:flex;align-items:center;justify-content:center;color:#2c3e50;
      text-shadow:0 1px 0 rgba(255,255,255,.7);
      background: transparent;
    }
    .days-text{font-size:12px;text-align:center;margin-top:8px;color:var(--text-light);font-weight:700}
    .status-ring-good{ --ring-color: var(--success); }
    .status-ring-warning{ --ring-color: var(--warning); }
    .status-ring-danger{ --ring-color: var(--danger); }

    footer{
      text-align:center;margin-top:30px;padding:22px;color:white;
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      border-radius:14px; box-shadow: var(--depth-2);
    }

    /* ===== Modales ===== */
    .modal{
      display:none; position:fixed; inset:0; background-color: rgba(0,0,0,.45);
      z-index: 9999; justify-content:center; align-items:center; backdrop-filter: blur(6px);
    }
    .modal-content{
      background: linear-gradient(180deg, rgba(255,255,255,.92), rgba(255,255,255,.98));
      border-radius:18px; width:96%; max-width:1400px; padding:28px;
      box-shadow: var(--depth-3); max-height:90vh; overflow-y:auto; position:relative;
      border:1px solid rgba(52,152,219,.15)
    }
    .modal-header{text-align:center;margin-bottom:18px;position:relative}
    .close-modal{
      position:absolute;top:-10px;right:-10px;width:34px;height:34px;background: var(--danger);
      color:white;border:none;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;
      box-shadow: 0 6px 12px rgba(231, 76, 60,.35)
    }

    /* ===== LOGIN (social) ===== */
    .social-login{display:grid;grid-template-columns:1fr;gap:10px;margin:16px 0 6px;}
    .btn-social{
      display:flex;align-items:center;gap:10px;justify-content:center;padding:12px;border-radius:12px;font-weight:800;border:none;cursor:pointer;
      background:#fff; box-shadow: var(--depth-1); transition: transform .2s ease, box-shadow .2s ease, filter .2s ease;
    }
    .btn-social:hover{transform: translateY(-2px); box-shadow: var(--depth-2)}
    .btn-google{border:2px solid #ececec}
    .btn-google i{color:#DB4437}
    .btn-facebook{background: linear-gradient(180deg,#1877F2,#1257c0); color:#fff}
    .btn-facebook i{color:#fff}
    .btn-apple{background:#000;color:#fff}
    .btn-apple i{color:#fff}

    /* ===== Formulario Nueva Póliza (rediseño pro) ===== */
    #policyForm .form-grid{
      display:grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap:14px;
    }
    @media (max-width:720px){ #policyForm .form-grid{ grid-template-columns: 1fr } }
    .form-group{display:flex;flex-direction:column;gap:8px}
    .form-label{
      font-weight:800; color:#1f2d3d; font-size:14px;
      display:flex; align-items:center; gap:8px;
    }
    .hint{font-size:12px; color:#567; font-weight:600}
    .input-wrap{
      display:flex; align-items:center; gap:10px; padding:12px 14px; border-radius:12px;
      background:linear-gradient(180deg,#ffffff,#f7faff);
      border:1px solid rgba(52,152,219,.18); box-shadow: var(--depth-1);
    }
    .input-wrap i{color:#2c80b9}
    .input-wrap input, .input-wrap select, .input-wrap textarea{
      width:100%; border:none; outline:none; background:transparent; font-size:15px; color:#1f2d3d;
    }
    .input-wrap textarea{min-height:120px; resize:vertical}
    .section-card{
      background:linear-gradient(180deg,#ffffff,#f6f8ff);
      border:1px solid rgba(52,152,219,.15); border-radius:16px; padding:16px; box-shadow: var(--depth-1); margin-bottom:14px
    }
    .section-title{font-weight:900; color:#155a8f; margin-bottom:8px; display:flex; align-items:center; gap:8px}

    /* ===== Renovación ===== */
    .renewal-layout{display:grid; grid-template-columns: 1fr 1.25fr; gap:20px; align-items:start;}
    @media (max-width:1180px){ .renewal-layout{grid-template-columns:1fr} }
    .renewal-col{
      background: linear-gradient(180deg,#ffffff,#f9fbff);
      border:1px solid rgba(52,152,219,.12); border-radius:14px; box-shadow: var(--depth-1); padding:16px;
      align-self: start;
    }
    .renewal-col h3{margin:4px 0 12px; font-size:16px; color:#1f2d3d}
    .renewal-options{max-height:none; overflow:visible}
    .insurer-option{
      display:grid; grid-template-columns: 52px 1fr auto; gap:12px;
      align-items:center; padding:12px; border:2px solid #ecf0f1; border-radius:12px; margin-bottom:10px;
      cursor:pointer; transition: transform .25s, border-color .25s, background-color .25s;
      background:#fff; box-shadow: var(--depth-1); outline:none; will-change: transform;
    }
    .insurer-option:hover{border-color: var(--primary); transform: translateX(6px)}
    .insurer-option.selected{border-color: var(--primary); background-color: rgba(52,152,219,.06)}
    .insurer-logo-small{
      width:52px;height:52px;display:flex;align-items:center;justify-content:center;font-weight:800;color:white;border-radius:10px;background: var(--primary);
      flex:0 0 52px; overflow:hidden;
    }
    .insurer-logo-small img{width:100%;height:100%;object-fit:contain;transform:none!important;transition:none!important;pointer-events:none}
    .insurer-details{display:flex;flex-direction:column; gap:2px}
    .insurer-details .coverage-amount{color:#567; font-weight:600}
    .insurer-price{font-weight:900;color:var(--primary-dark); text-align:right; min-width:130px}

    /* Parpadeo para opción más económica */
    @keyframes blink-green {
      0%, 100 { box-shadow: 0 0 0 2px rgba(46,204,113,.9), 0 0 12px rgba(46,204,113,.35); }
      50% { box-shadow: 0 0 0 2px rgba(46,204,113,.3), 0 0 2px rgba(46,204,113,.1); }
    }
    .insurer-option.cheapest{border-color:#2ecc71 !important; animation: blink-green 1.2s infinite;}

    /* Tabla Comparativa */
    .compare-title{font-weight:800; color:#1f2d3d; margin-bottom:8px; display:flex; align-items:center; gap:8px;}
    .compare-table{width:100%; border-collapse:separate; border-spacing:0; overflow:hidden; border-radius:12px; box-shadow: var(--depth-1)}
    .compare-table thead th{
      background: linear-gradient(180deg,#eef6ff,#e8f1ff);
      color:#1f2d3d; text-align:left; font-weight:800; padding:12px; border-bottom:1px solid rgba(52,152,219,.15);
    }
    .compare-table tbody td{background:#fff; padding:12px; border-bottom:1px solid #f0f3f7; vertical-align:middle}
    .compare-table tbody tr:last-child td{border-bottom:none}
    .compare-table img{width:28px;height:28px;object-fit:contain;transform:none!important;transition:none!important;pointer-events:none}
    .pill{display:inline-block; padding:4px 10px; border-radius:999px; font-weight:700; font-size:12px; background: linear-gradient(180deg,#f7fbff,#eef6ff); border:1px solid rgba(52,152,219,.2); color:#2c3e50;}
    .table-actions{display:flex; gap:8px; flex-wrap:wrap}
    .btn-mini{padding:8px 12px; border-radius:10px; font-weight:700; border:1px solid rgba(52,152,219,.2); background:#fff; box-shadow: var(--depth-1); cursor:pointer}
    .selected-row{box-shadow: inset 0 0 0 2px rgba(52,152,219,.35)}

    /* Pago */
    #paymentModal .modal-content{max-width:720px}
    .pay-tabs{display:flex; gap:8px; flex-wrap:wrap; margin-bottom:12px}
    .pay-tab{
      padding:10px 14px; border-radius:10px; border:1px solid rgba(52,152,219,.2); background:#fff; box-shadow: var(--depth-1);
      cursor:pointer; font-weight:700; display:flex; align-items:center; gap:8px;
    }
    .pay-tab.active{background:linear-gradient(180deg,#f1f9ff,#e7f2ff); border-color:rgba(52,152,219,.45)}
    .pay-help{color:#567; font-weight:600; margin-bottom:10px}
    .inline-2{display:grid; grid-template-columns:1fr 1fr; gap:10px}
    @media (max-width:560px){ .inline-2{grid-template-columns:1fr} }

    /* Success */
    #successModal .success-card{
      background: linear-gradient(180deg,#ffffff,#f6fffb);
      padding:30px;border-radius:18px;box-shadow: var(--depth-3); text-align:center; width:min(520px, 92vw);
      border:1px solid rgba(46,204,113,.2)
    }
    .checkmark{
      width:100px;height:100px;border-radius:50%;margin:0 auto 16px;position:relative; background: radial-gradient(circle at 30% 30%, #8ef0be, #2ecc71);
      box-shadow: inset 0 8px 14px rgba(255,255,255,.6), inset 0 -8px 12px rgba(0,0,0,.08), 0 12px 22px rgba(46,204,113,.35);
      animation: popScale .5s ease-out both;
    }
    @keyframes popScale{0%{transform:scale(.8);opacity:.0}100%{transform:scale(1);opacity:1}}
    .checkmark svg{position:absolute; inset:0; margin:auto; width:64px;height:64px;filter: drop-shadow(0 2px 2px rgba(0,0,0,.15))}
    .checkmark .path{stroke:#fff; stroke-width:8; stroke-linecap:round; stroke-linejoin:round; fill:none; stroke-dasharray: 100; stroke-dashoffset: 100; animation: draw .7s .2s ease forwards;}
    @keyframes draw{to{stroke-dashoffset:0}}

    /* Responsivo general */
    @media (max-width:768px){
      .stats-bar{flex-direction:column;gap:20px}
      .stat-item:not(:last-child)::after{display:none}
      header{flex-direction:column;gap:15px;text-align:center}
      .user-actions{justify-content:center}
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <header>
      <div class="app-title">
        <div class="app-icon">
          <img src="logos/insurahublogo.png" alt="InsuraHub" onerror="this.remove(); this.parentNode.textContent='IH'">
        </div>
        <div class="app-title-text">
          <h1>InsuraHub</h1>
          <p>Gestión Inteligente de Seguros</p>
        </div>
      </div>
      <div class="user-actions">
        <button class="btn" id="addPolicyBtn"><i class="fas fa-plus"></i> Nueva Póliza</button>
        <button class="btn btn-outline" id="loginBtn"><i class="fas fa-user"></i> Iniciar Sesión</button>
      </div>
    </header>

    <!-- Stats -->
    <div class="stats-bar">
      <div class="stat-item">
        <div class="stat-value" id="totalPolicies">6</div>
        <div class="stat-label">Pólizas Activas</div>
      </div>
      <div class="stat-item">
        <div class="stat-value" id="expiringPolicies">2</div>
        <div class="stat-label">Por Vencer (&lt;30 días)</div>
      </div>
      <div class="stat-item">
        <div class="stat-value" id="totalCoverage">$985.000.000</div>
        <div class="stat-label">Cobertura Total</div>
      </div>
    </div>

    <!-- Grid pólizas -->
    <div class="card-grid" id="policyGrid"></div>
  </div>

  <!-- ===== Modales ===== -->
  <!-- Login -->
  <div class="modal" id="loginModal" aria-hidden="true">
    <div class="modal-content" role="dialog" aria-modal="true">
      <div class="modal-header">
        <h2>Iniciar Sesión</h2>
        <p>Accede a tu cuenta para gestionar tus seguros</p>
        <button class="close-modal" id="closeLoginModal">×</button>
      </div>
      <div class="social-login">
        <button type="button" class="btn-social btn-google" id="loginGoogle"><i class="fab fa-google"></i> Continuar con Google</button>
        <button type="button" class="btn-social btn-facebook" id="loginFacebook"><i class="fab fa-facebook-f"></i> Continuar con Facebook</button>
        <button type="button" class="btn-social btn-apple" id="loginApple"><i class="fab fa-apple"></i> Continuar con Apple</button>
      </div>
      <div style="text-align:center;color:#99a3ad;font-weight:700;margin:8px 0 14px">o con tu correo</div>
      <form>
        <div class="form-group">
          <label class="form-label" for="email"><i class="fas fa-envelope"></i> Correo Electrónico</label>
          <div class="input-wrap"><input type="email" id="email" required placeholder="tucorreo@dominio.com"></div>
        </div>
        <div class="form-group">
          <label class="form-label" for="password"><i class="fas fa-lock"></i> Contraseña</label>
          <div class="input-wrap"><input type="password" id="password" required placeholder="••••••••"></div>
        </div>
        <button type="submit" class="btn" style="width:100%"><i class="fas fa-right-to-bracket"></i> Iniciar Sesión</button>
      </form>
    </div>
  </div>

  <!-- Nueva Póliza (form pro 3D) -->
  <div class="modal" id="policyModal" aria-hidden="true">
    <div class="modal-content" role="dialog" aria-modal="true">
      <div class="modal-header">
        <h2>Registrar Nueva Póliza</h2>
        <p>Completa la información de la póliza</p>
        <button class="close-modal" id="closePolicyModal">×</button>
      </div>

      <form id="policyForm">
        <!-- Asegurado -->
        <div class="section-card">
          <div class="section-title"><i class="fas fa-id-card"></i> Datos del asegurado</div>
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label" for="insuredId"><i class="fas fa-hashtag"></i> Identificación</label>
              <div class="input-wrap"><input type="text" id="insuredId" required placeholder="Ej: 1234567890"></div>
              <div class="hint">Cédula o NIT del titular</div>
            </div>
            <div class="form-group">
              <label class="form-label" for="insuredName"><i class="fas fa-user"></i> Nombre y Apellidos</label>
              <div class="input-wrap"><input type="text" id="insuredName" required placeholder="Nombre completo"></div>
            </div>
          </div>
        </div>

        <!-- Póliza -->
        <div class="section-card">
          <div class="section-title"><i class="fas fa-shield-halved"></i> Datos de la póliza</div>
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label" for="insuranceType"><i class="fas fa-rectangle-list"></i> Tipo de Seguro</label>
              <div class="input-wrap">
                <select id="insuranceType" required>
                  <option value="">Selecciona un tipo</option>
                  <option value="auto">Seguro de Auto</option>
                  <option value="home">Seguro de Hogar</option>
                  <option value="life">Seguro de Vida</option>
                  <option value="health">Seguro Médico</option>
                  <option value="travel">Seguro de Viaje</option>
                  <option value="business">Seguro de Negocio</option>
                </select>
              </div>
            </div>
            <div class="form-group">
              <label class="form-label" for="policyNumber"><i class="fas fa-hashtag"></i> Número de Póliza</label>
              <div class="input-wrap"><input type="text" id="policyNumber" required placeholder="Ej: #AUTO-123456"></div>
            </div>
            <div class="form-group">
              <label class="form-label" for="coverageAmount"><i class="fas fa-coins"></i> Valor de Cobertura (COP)</label>
              <div class="input-wrap"><input type="number" id="coverageAmount" required placeholder="Ej: 500000000"></div>
            </div>
            <div class="form-group">
              <label class="form-label" for="expirationDate"><i class="fas fa-calendar-day"></i> Fecha de Vencimiento</label>
              <div class="input-wrap"><input type="date" id="expirationDate" required></div>
            </div>
            <div class="form-group">
              <label class="form-label" for="insurer"><i class="fas fa-building-shield"></i> Aseguradora</label>
              <div class="input-wrap">
                <select id="insurer" required>
                  <option value="">Selecciona una aseguradora</option>
                  <option value="allianz">Allianz</option>
                  <option value="axa">AXA</option>
                  <option value="generali">Generali</option>
                  <option value="cigna">Cigna</option>
                  <option value="zurich">Zurich</option>
                  <option value="liberty">Liberty Mutual</option>
                </select>
              </div>
            </div>
            <div class="form-group" style="grid-column: 1 / -1">
              <label class="form-label" for="policyConditions"><i class="fas fa-file-lines"></i> Condiciones de la Póliza</label>
              <div class="input-wrap"><textarea id="policyConditions" placeholder="Describe exclusiones, deducibles, límites, y condiciones particulares..."></textarea></div>
            </div>
          </div>
        </div>

        <button type="submit" class="btn" style="width:100%"><i class="fas fa-floppy-disk"></i> Registrar Póliza</button>
      </form>
    </div>
  </div>

  <!-- Renovación -->
  <div class="modal" id="renewalModal" aria-hidden="true">
    <div class="modal-content" role="dialog" aria-modal="true">
      <div class="modal-header">
        <h2>Renovar Póliza</h2>
        <p>Selecciona una aseguradora y compara en tiempo real</p>
        <button class="close-modal" id="closeRenewalModal">×</button>
      </div>
      <div class="renewal-layout">
        <!-- Columna izquierda -->
        <div class="renewal-col">
          <h3>Póliza a renovar</h3>
          <div class="detail-value" id="renewalPolicyNumber" style="margin-bottom:8px">#AUTO-123456</div>

          <h3>Selecciona una aseguradora</h3>
          <div class="renewal-options" id="renewalOptions">
            <div class="insurer-option" data-insurer="allianz" data-price="850000" tabindex="0" role="button" aria-selected="false">
              <div class="insurer-logo-small"><img src="logos/allianz.png" alt="Allianz" onerror="this.style.display='none'; this.parentNode.innerHTML='A';"></div>
              <div class="insurer-details"><div>Allianz Seguros</div><div class="coverage-amount">Cobertura: $200.000.000</div></div>
              <div class="insurer-price">$850.000</div>
            </div>
            <div class="insurer-option" data-insurer="axa" data-price="920000" tabindex="0" role="button" aria-selected="false">
              <div class="insurer-logo-small"><img src="logos/axa.png" alt="AXA" onerror="this.style.display='none'; this.parentNode.innerHTML='A';"></div>
              <div class="insurer-details"><div>AXA Seguros</div><div class="coverage-amount">Cobertura: $220.000.000</div></div>
              <div class="insurer-price">$920.000</div>
            </div>
            <div class="insurer-option" data-insurer="generali" data-price="780000" tabindex="0" role="button" aria-selected="false">
              <div class="insurer-logo-small"><img src="logos/generali.png" alt="Generali" onerror="this.style.display='none'; this.parentNode.innerHTML='G';"></div>
              <div class="insurer-details"><div>Generali Seguros</div><div class="coverage-amount">Cobertura: $180.000.000</div></div>
              <div class="insurer-price">$780.000</div>
            </div>
            <div class="insurer-option" data-insurer="cigna" data-price="950000" tabindex="0" role="button" aria-selected="false">
              <div class="insurer-logo-small"><img src="logos/cigna.png" alt="Cigna" onerror="this.style.display='none'; this.parentNode.innerHTML='C';"></div>
              <div class="insurer-details"><div>Cigna Seguros</div><div class="coverage-amount">Cobertura: $240.000.000</div></div>
              <div class="insurer-price">$950.000</div>
            </div>
            <div class="insurer-option" data-insurer="zurich" data-price="890000" tabindex="0" role="button" aria-selected="false">
              <div class="insurer-logo-small"><img src="logos/zurich.png" alt="Zurich" onerror="this.style.display='none'; this.parentNode.innerHTML='Z';"></div>
              <div class="insurer-details"><div>Zurich Seguros</div><div class="coverage-amount">Cobertura: $210.000.000</div></div>
              <div class="insurer-price">$890.000</div>
            </div>
            <div class="insurer-option" data-insurer="liberty" data-price="810000" tabindex="0" role="button" aria-selected="false">
              <div class="insurer-logo-small"><img src="logos/liberty.png" alt="Liberty Mutual" onerror="this.style.display='none'; this.parentNode.innerHTML='L';"></div>
              <div class="insurer-details"><div>Liberty Mutual</div><div class="coverage-amount">Cobertura: $190.000.000</div></div>
              <div class="insurer-price">$810.000</div>
            </div>
          </div>

          <button type="button" class="btn" style="width:100%; margin-top:12px" id="confirmRenewal">
            <i class="fas fa-check-circle"></i> Confirmar Renovación
          </button>
          <div class="pay-help" id="payHint" style="display:none; margin-top:8px">
            <i class="fas fa-credit-card"></i> Forma de pago seleccionada: <strong id="payMethodLabel">—</strong>
          </div>
        </div>

        <!-- Columna derecha -->
        <div class="renewal-col">
          <div class="compare-title"><i class="fas fa-scale-balanced"></i> Comparación rápida</div>
          <div id="currentPolicyChip" style="margin-bottom:8px"></div>
          <div class="table-responsive">
            <table class="compare-table" id="compareTable">
              <thead>
                <tr>
                  <th>Aseguradora</th>
                  <th>Precio</th>
                  <th>Cobertura</th>
                  <th>Deducible</th>
                  <th>Extras</th>
                  <th>Detalle</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Condiciones -->
  <div class="modal" id="conditionsModal" aria-hidden="true">
    <div class="modal-content" role="dialog" aria-modal="true">
      <div class="modal-header">
        <h2 id="conditionsTitle">Condiciones</h2>
        <p id="conditionsSubtitle" style="color:#567;font-weight:600"></p>
        <button class="close-modal" id="closeConditionsModal">×</button>
      </div>
      <div class="conditions-text" id="conditionsBody" style="white-space:pre-wrap; background:#fff; border:1px solid rgba(52,152,219,.15); border-radius:12px; padding:14px; box-shadow: var(--depth-1)"></div>
    </div>
  </div>

  <!-- Pago -->
  <div class="modal" id="paymentModal" aria-hidden="true">
    <div class="modal-content" role="dialog" aria-modal="true">
      <div class="modal-header">
        <h2>Formas de Pago</h2>
        <p id="paymentSubtitle" style="color:#567;font-weight:600">Selecciona y completa los datos</p>
        <button class="close-modal" id="closePaymentModal">×</button>
      </div>

      <div class="pay-tabs" id="payTabs">
        <button class="pay-tab active" data-method="tarjeta"><i class="fas fa-credit-card"></i> Tarjeta</button>
        <button class="pay-tab" data-method="pse"><i class="fas fa-building-columns"></i> PSE</button>
        <button class="pay-tab" data-method="transferencia"><i class="fas fa-money-bill-transfer"></i> Transferencia</button>
        <button class="pay-tab" data-method="efectivo"><i class="fas fa-coins"></i> Efectivo</button>
      </div>

      <div id="payForms">
        <div class="pay-form" data-method="tarjeta">
          <div class="form-group"><label class="form-label">Nombre en la tarjeta</label><div class="input-wrap"><i class="fas fa-user"></i><input type="text" id="cardName" placeholder="Como aparece en la tarjeta"></div></div>
          <div class="form-group"><label class="form-label">Número de tarjeta</label><div class="input-wrap"><i class="fas fa-credit-card"></i><input type="text" id="cardNumber" placeholder="#### #### #### ####" inputmode="numeric" maxlength="19"></div></div>
          <div class="inline-2">
            <div class="form-group"><label class="form-label">Vencimiento (MM/AA)</label><div class="input-wrap"><i class="fas fa-calendar"></i><input type="text" id="cardExp" placeholder="MM/AA" maxlength="5"></div></div>
            <div class="form-group"><label class="form-label">CVV</label><div class="input-wrap"><i class="fas fa-key"></i><input type="password" id="cardCVV" placeholder="***" maxlength="4"></div></div>
          </div>
        </div>

        <div class="pay-form" data-method="pse" style="display:none">
          <div class="form-group"><label class="form-label">Banco</label>
            <div class="input-wrap"><i class="fas fa-building-columns"></i>
              <select id="pseBank">
                <option value="">Selecciona tu banco</option>
                <option>Bancolombia</option>
                <option>Davivienda</option>
                <option>Banco de Bogotá</option>
                <option>BBVA</option>
                <option>Nequi</option>
              </select>
            </div>
          </div>
          <div class="form-group"><label class="form-label">Correo del titular</label><div class="input-wrap"><i class="fas fa-envelope"></i><input type="email" id="pseEmail" placeholder="tucorreo@dominio.com"></div></div>
        </div>

        <div class="pay-form" data-method="transferencia" style="display:none">
          <div class="conditions-text" style="margin-bottom:10px">
            Transferir a:<br>
            - Banco: Bancolombia (AHORROS)<br>
            - No. Cuenta: 123-456789-01<br>
            - Titular: InsuraHub S.A.S<br>
            - NIT: 900.123.456-7
          </div>
          <div class="form-group"><label class="form-label">Adjunta comprobante (opcional)</label><div class="input-wrap"><i class="fas fa-paperclip"></i><input type="file" id="trfReceipt" accept="image/*,application/pdf"></div></div>
        </div>

        <div class="pay-form" data-method="efectivo" style="display:none">
          <div class="conditions-text">
            Paga en puntos aliados (Efecty/Baloto). Recibirás un código al confirmar la renovación.
          </div>
        </div>
      </div>

      <button class="btn" id="savePayment" style="width:100%; margin-top:10px"><i class="fas fa-floppy-disk"></i> Guardar forma de pago</button>
    </div>
  </div>

  <!-- Success -->
  <div class="modal" id="successModal" aria-hidden="true" style="z-index:10000">
    <div class="success-card" role="alert" aria-live="polite">
      <div class="checkmark"><svg viewBox="0 0 64 64"><path class="path" d="M16 34 L28 46 L50 22"></path></svg></div>
      <div id="successMessage">¡Operación exitosa!</div>
      <div id="successSub"></div>
    </div>
  </div>

  <footer><p style="text-align:center;margin-top:24px;color:#fff">© 2025 InsuraHub - Todos tus seguros en un solo lugar</p></footer>

  <script>
    /* ===== Datos base ===== */
    const insurerLogos = {
      allianz:"logos/allianz.png",
      axa:"logos/axa.png",
      generali:"logos/generali.png",
      cigna:"logos/cigna.png",
      zurich:"logos/zurich.png",
      liberty:"logos/liberty.png"
    };
    const insurerNames = { allianz:"Allianz", axa:"AXA", generali:"Generali", cigna:"Cigna", zurich:"Zurich", liberty:"Liberty Mutual" };
    const insurerPhones = { allianz:"+57 01 8000 510 510", axa:"+57 01 8000 123 456", generali:"+57 01 8000 345 678", cigna:"+57 01 8000 765 432", zurich:"+57 01 8000 111 222", liberty:"+57 01 8000 999 888" };

    const renewalPrices = {allianz:850000, axa:920000, generali:780000, cigna:950000, zurich:890000, liberty:810000};
    const coverageAmounts = {allianz:200000000, axa:220000000, generali:180000000, cigna:240000000, zurich:210000000, liberty:190000000};

    const offerConditions = {
      allianz:{deductible:"10% o $2.000.000", extras:"Asistencia 24/7 + carro sustituto", details:"- Cobertura daños y pérdida total.\n- Deducible: 10% o $2.000.000.\n- Asistencia vial 24/7, grúa, cerrajería.\n- Carro sustituto 5 días por siniestro.\n- Exclusiones: embriaguez, uso competitivo."},
      axa:{deductible:"8% o $1.800.000", extras:"Vidrios sin deducible", details:"- Cobertura ampliada + RC.\n- Deducible: 8% o $1.800.000.\n- Reposición de vidrios sin deducible.\n- Asistencia jurídica.\n- Exclusiones: dolo, carreras."},
      generali:{deductible:"12% o $2.200.000", extras:"Revisión anual preventiva", details:"- Cobertura estándar integral.\n- Deducible: 12% o $2.200.000.\n- Revisión mecánica preventiva anual.\n- Cobertura a accesorios declarados.\n- Exclusiones: accesorios no declarados."},
      cigna:{deductible:"10% o $2.500.000", extras:"Cobertura médica ampliada", details:"- Enfoque salud/viaje.\n- Deducible: 10% o $2.500.000.\n- Gastos médicos ampliados.\n- Telemedicina.\n- Exclusiones: preexistencias según plan."},
      zurich:{deductible:"9% o $2.000.000", extras:"RC ampliada + asistencia jurídica", details:"- Cobertura integral + RC ampliada.\n- Deducible: 9% o $2.000.000.\n- Asistencia jurídica.\n- Coberturas internacionales acotadas.\n- Exclusiones: uso comercial sin declaración."},
      liberty:{deductible:"10% o $1.900.000", extras:"Pérdida de llaves + grúa", details:"- Cobertura estándar.\n- Deducible: 10% o $1.900.000.\n- Pérdida de llaves.\n- Grúa 2 eventos/año.\n- Exclusiones: desgaste normal."}
    };

    function formatCurrencyCOP(amount){
      return new Intl.NumberFormat('es-CO',{style:'currency',currency:'COP',minimumFractionDigits:0,maximumFractionDigits:0}).format(amount);
    }
    function addDays(date,days){const r=new Date(date); r.setDate(r.getDate()+days); return r;}
    function addYears(date, years){ const d=new Date(date); const y=d.getFullYear()+years; d.setFullYear(y); return d; } // evita 366 por TZ/DST
    function formatDateISO(date){return date.toISOString().split('T')[0];}
    function formatDateHuman(dateStr){const d=new Date(dateStr); return d.toLocaleDateString('es-ES',{year:'numeric',month:'long',day:'numeric'});}
    function telFor(insurer){ return insurerPhones[insurer] || "N/A"; }

    const today = new Date();
    const expirationDates = [
      formatDateISO(addDays(today,28)), formatDateISO(addDays(today,120)),
      formatDateISO(addDays(today,230)), formatDateISO(addDays(today,350)),
      formatDateISO(addDays(today,15)),  formatDateISO(addDays(today,80))
    ];

    const policies = [
      {id:1,type:"auto",typeName:"Seguro de Auto",insurer:"allianz",insurerName:"Allianz",policyNumber:"#AUTO-789456",expirationDate:expirationDates[0],insuredId:"1234567890",insuredName:"Juan Pérez",coverage:200000000,
        conditions:"- Deducible: 10% del siniestro o $2.000.000, lo que sea mayor.\n- Cobertura pérdida total/daños parciales.\n- Asistencia en carretera 24/7.\n- Exclusiones: conducción en estado de embriaguez, uso competitivo."},
      {id:2,type:"home",typeName:"Seguro de Hogar",insurer:"axa",insurerName:"AXA",policyNumber:"#HOME-123789",expirationDate:expirationDates[1],insuredId:"0987654321",insuredName:"María García",coverage:350000000,
        conditions:"- Cobertura incendio, terremoto y robo calificado.\n- Deducible: 1% del valor asegurado por evento.\n- Límites para contenidos: $50.000.000.\n- Exclusiones: humedad por falta de mantenimiento."},
      {id:3,type:"life",typeName:"Seguro de Vida",insurer:"generali",insurerName:"Generali",policyNumber:"#LIFE-456123",expirationDate:expirationDates[2],insuredId:"4561237890",insuredName:"Carlos López",coverage:150000000,
        conditions:"- Fallecimiento por cualquier causa (carencia 90 días para enfermedad).\n- Anticipo por enfermedad terminal 30%.\n- Exclusiones: suicidio dentro de los primeros 2 años."},
      {id:4,type:"health",typeName:"Seguro Médico",insurer:"cigna",insurerName:"Cigna",policyNumber:"#MED-987321",expirationDate:expirationDates[3],insuredId:"7890123456",insuredName:"Ana Rodríguez",coverage:120000000,
        conditions:"- Red de prestadores nacional.\n- Copago por consulta general: $40.000.\n- Preexistencias cubiertas después de 12 meses.\n- Exclusiones: procedimientos estéticos."},
      {id:5,type:"travel",typeName:"Seguro de Viaje",insurer:"zurich",insurerName:"Zurich",policyNumber:"#TRAV-654987",expirationDate:expirationDates[4],insuredId:"3216549870",insuredName:"Laura Martínez",coverage:50000000,
        conditions:"- Asistencia médica internacional hasta $50.000.000.\n- Repatriación sanitaria y pérdida de equipaje.\n- Franquicia por evento: $100.000."},
      {id:6,type:"business",typeName:"Seguro de Negocio",insurer:"liberty",insurerName:"Liberty Mutual",policyNumber:"#BUSI-321654",expirationDate:expirationDates[5],insuredId:"6549873210",insuredName:"Pedro Sánchez",coverage:115000000,
        conditions:"- Responsabilidad civil comercial hasta $500.000.000.\n- Interrupción de negocio (30 días carencia).\n- Deducible: $1.500.000 por evento."}
    ];

    const typeIcons = {auto:"car",home:"home",life:"heart",health:"heartbeat",travel:"plane",business:"briefcase"};

    /* ===== DOM ===== */
    const loginBtn = document.getElementById('loginBtn');
    const loginModal = document.getElementById('loginModal');
    const addPolicyBtn = document.getElementById('addPolicyBtn');
    const policyModal = document.getElementById('policyModal');
    const renewalModal = document.getElementById('renewalModal');
    const conditionsModal = document.getElementById('conditionsModal');
    const paymentModal = document.getElementById('paymentModal');
    const successModal = document.getElementById('successModal');

    const policyForm = document.getElementById('policyForm');
    const renewalOptions = document.getElementById('renewalOptions');
    const compareTableBody = document.getElementById('compareTable').querySelector('tbody');
    const currentPolicyChip = document.getElementById('currentPolicyChip');
    const confirmRenewalBtn = document.getElementById('confirmRenewal');
    const policyGrid = document.getElementById('policyGrid');
    const totalPoliciesEl = document.getElementById('totalPolicies');
    const expiringPoliciesEl = document.getElementById('expiringPolicies');
    const totalCoverageEl = document.getElementById('totalCoverage');
    const payTabs = document.getElementById('payTabs');
    const payHint = document.getElementById('payHint');
    const payMethodLabel = document.getElementById('payMethodLabel');

    let currentRenewPolicyId = null;
    let selectedPayment = { method: null };

    /* ===== Modals open/close ===== */
    document.getElementById('closeLoginModal').addEventListener('click',()=> loginModal.style.display='none');
    document.getElementById('closePolicyModal').addEventListener('click',()=> policyModal.style.display='none');
    document.getElementById('closeRenewalModal').addEventListener('click',()=> renewalModal.style.display='none');
    document.getElementById('closeConditionsModal').addEventListener('click',()=> conditionsModal.style.display='none');
    document.getElementById('closePaymentModal').addEventListener('click',()=> paymentModal.style.display='none');

    loginBtn.addEventListener('click',()=> loginModal.style.display='flex');
    addPolicyBtn.addEventListener('click',()=> policyModal.style.display='flex');

    [loginModal, policyModal, renewalModal, conditionsModal, paymentModal, successModal].forEach(modal=>{
      modal.addEventListener('click',(e)=>{ if(e.target===modal) modal.style.display='none' });
    });

    // Social auth (stub)
    document.getElementById('loginGoogle')?.addEventListener('click',()=> alert('Continuar con Google (conectar OAuth aquí)'));
    document.getElementById('loginFacebook')?.addEventListener('click',()=> alert('Continuar con Facebook (conectar OAuth aquí)'));
    document.getElementById('loginApple')?.addEventListener('click',()=> alert('Continuar con Apple (conectar OAuth aquí)'));

    /* ===== Helpers ===== */
    function getDaysRemaining(expirationDate){
      const t=new Date(); t.setHours(0,0,0,0);
      const exp=new Date(expirationDate);
      const diff=exp-t; const days=Math.ceil(diff/(1000*60*60*24));
      return days>=0?days:0;
    }
    function getStatusClass(days){ if(days>180) return "good"; if(days>30) return "warning"; return "danger"; }
    function getRingClass(days){ if(days>180) return "status-ring-good"; if(days>30) return "status-ring-warning"; return "status-ring-danger"; }
    function getRingProgress(days){ if(days>365) return 100; return (days/365)*100; }

    function openConditionsModal(title, subtitle, body){
      document.getElementById('conditionsTitle').textContent = title || "Condiciones";
      document.getElementById('conditionsSubtitle').textContent = subtitle || "";
      document.getElementById('conditionsBody').textContent = body || "Sin información.";
      conditionsModal.style.display='flex';
    }
    function showSuccess(title, sub){
      document.getElementById('successMessage').textContent = title || "¡Operación exitosa!";
      document.getElementById('successSub').textContent = sub || "";
      successModal.style.display='flex';
      setTimeout(()=>{ successModal.style.display='none'; }, 1600);
    }

    /* ===== Render de pólizas ===== */
    function renderPolicies(){
      policyGrid.innerHTML=''; let expiringCount=0; let totalCoverage=0;
      policies.forEach(policy=>{
        const days = getDaysRemaining(policy.expirationDate);
        if(days<=30) expiringCount++;
        totalCoverage += policy.coverage;

        const statusClass = getStatusClass(days);
        const ringClass = getRingClass(days);
        const progress = getRingProgress(days);

        const card = document.createElement('div');
        card.className='card';
        card.classList.add(`status-${statusClass}`);
        card.innerHTML = `
          <div class="card-header">
            <div class="insurance-type">${policy.typeName}</div>
            <div class="insurance-icon"><i class="fas fa-${typeIcons[policy.type]}"></i></div>
          </div>

          <div class="card-details">
            <div class="logo-container">
              <img src="${insurerLogos[policy.insurer]}" alt="${policy.insurerName}" class="company-logo"
                   onerror="this.style.display='none'; this.parentNode.innerHTML='<div class=\'logo-placeholder\'>${policy.insurerName}</div>';"/>
            </div>

            <div class="detail-item"><span class="detail-label">Asegurado:</span><span class="detail-value">${policy.insuredName}</span></div>
            <div class="detail-item"><span class="detail-label">ID:</span><span class="detail-value">${policy.insuredId}</span></div>
            <div class="detail-item"><span class="detail-label">Póliza:</span><span class="detail-value">${policy.policyNumber}</span></div>
            <div class="detail-item"><span class="detail-label">Vencimiento:</span><span class="detail-value">${new Date(policy.expirationDate).toLocaleDateString('es-ES')}</span></div>
            <div class="detail-item"><span class="detail-label">Cobertura:</span><span class="detail-value">${formatCurrencyCOP(policy.coverage)}</span></div>

            <div class="contact-line"><i class="fas fa-phone"></i> <span>Contacto aseguradora:</span> <span style="font-weight:900">${telFor(policy.insurer)}</span></div>

            <div class="status-container">
              <div class="status-ring ${ringClass}" style="--progress:${progress}%">
                <div class="status-ring-inner">${days}</div>
              </div>
              <div class="days-text">días restantes</div>
            </div>
          </div>

          <div class="card-actions">
            <button class="btn btn-soft conditions-btn"><i class="fas fa-file-lines"></i> Ver condiciones actuales</button>
            <button class="btn ${days>180?'btn-success':(days>30?'btn-warning':'btn-danger')} renew-btn" data-policy-id="${policy.id}">
              <i class="fas fa-sync-alt"></i> ${days>30?'Renovación Automática':'Renovar Ahora'}
            </button>
          </div>
        `;

        card.querySelector('.conditions-btn').addEventListener('click', ()=>{
          openConditionsModal("Condiciones de la Póliza", `${policy.policyNumber} · ${policy.insurerName}`, policy.conditions);
        });

        const renewBtn = card.querySelector('.renew-btn');
        renewBtn.addEventListener('click', function(){
          const id = this.getAttribute('data-policy-id');
          const p = policies.find(x=> x.id==id);
          currentRenewPolicyId = p.id;
          document.getElementById('renewalPolicyNumber').textContent = p.policyNumber;

          // Reset pago
          selectedPayment = { method: null };
          payHint.style.display='none';
          payMethodLabel.textContent = '—';

          // Refrescar precios/coberturas
          document.querySelectorAll('.insurer-option').forEach(opt=>{
            const insurer = opt.getAttribute('data-insurer');
            opt.querySelector('.insurer-price').textContent = formatCurrencyCOP(renewalPrices[insurer]);
            opt.querySelector('.coverage-amount').textContent = `Cobertura: ${formatCurrencyCOP(coverageAmounts[insurer])}`;
            opt.classList.remove('selected','cheapest'); opt.setAttribute('aria-selected','false');
          });

          // Opción más económica
          highlightCheapestOption();

          // Chip de póliza actual
          currentPolicyChip.innerHTML = `<span class="pill">Actual: ${p.insurerName} · Cobertura ${formatCurrencyCOP(p.coverage)} · Vence ${new Date(p.expirationDate).toLocaleDateString('es-ES')} <span style="font-size:11px; font-weight:800; color:#2cb56f; margin-left:6px">vigente</span></span>`;

          buildCompareTable(p);

          renewalModal.style.display='flex';
        });

        policyGrid.appendChild(card);
      });

      totalPoliciesEl.textContent = policies.length;
      expiringPoliciesEl.textContent = expiringCount;
      totalCoverageEl.textContent = formatCurrencyCOP(totalCoverage);
    }

    function buildCompareTable(policy){
      compareTableBody.innerHTML = '';
      const keys = ["allianz","axa","generali","cigna","zurich","liberty"];

      keys.forEach(key=>{
        const tr = document.createElement('tr');
        tr.setAttribute('data-insurer', key);

        const name = insurerNames[key];
        const price = renewalPrices[key];
        const cov   = coverageAmounts[key];
        const cond  = offerConditions[key];

        tr.innerHTML = `
          <td data-label="Aseguradora">
            <div style="display:flex;align-items:center;gap:8px">
              <img src="${insurerLogos[key]}" alt="${name}">
              <strong>${name}</strong>
            </div>
          </td>
          <td data-label="Precio">${formatCurrencyCOP(price)}</td>
          <td data-label="Cobertura">${formatCurrencyCOP(cov)}</td>
          <td data-label="Deducible">${cond?.deductible || "-"}</td>
          <td data-label="Extras">${cond?.extras || "-"}</td>
          <td data-label="Detalle">
            <div class="table-actions">
              <button class="btn-mini details" data-key="${key}"><i class="fas fa-eye"></i> Ver detalles</button>
            </div>
          </td>
        `;
        compareTableBody.appendChild(tr);
      });

      document.getElementById('compareTable').onclick = (e)=>{
        const btn = e.target.closest('button.details');
        if(!btn) return;
        const key = btn.getAttribute('data-key');
        const name = insurerNames[key];
        const body = offerConditions[key]?.details || "Sin detalles.";
        openConditionsModal(`Condiciones de la oferta · ${name}`, `Propuesta para ${policy.policyNumber}`, body);
      };
    }

    function highlightCompareRow(key){
      compareTableBody.querySelectorAll('tr').forEach(r=> r.classList.remove('selected-row'));
      const row = compareTableBody.querySelector(`tr[data-insurer="${key}"]`);
      if(row) row.classList.add('selected-row');
    }

    function highlightCheapestOption(){
      const options = Array.from(document.querySelectorAll('.insurer-option'));
      if(!options.length) return;
      let min = Infinity, minEl = null;
      options.forEach(opt=>{
        const price = Number(opt.getAttribute('data-price')) || 0;
        if(price < min){ min = price; minEl = opt; }
      });
      options.forEach(o=> o.classList.remove('cheapest'));
      if(minEl){ minEl.classList.add('cheapest'); }
    }

    // Selección aseguradora -> abre pago
    function selectInsurerOption(optionEl){
      if(!optionEl) return;
      document.querySelectorAll('.insurer-option').forEach(opt=>{
        opt.classList.remove('selected'); opt.setAttribute('aria-selected','false');
      });
      optionEl.classList.add('selected'); optionEl.setAttribute('aria-selected','true');
      const key = optionEl.getAttribute('data-insurer');
      highlightCompareRow(key);
      document.getElementById('paymentSubtitle').textContent = `Método para ${insurerNames[key]}`;
      paymentModal.style.display='flex';
    }
    renewalOptions.addEventListener('click',(e)=>{
      const option = e.target.closest('.insurer-option');
      if(!option) return;
      selectInsurerOption(option);
    });
    renewalOptions.addEventListener('keydown',(e)=>{
      const option = e.target.closest('.insurer-option');
      if(!option) return;
      if(e.key === 'Enter' || e.key === ' '){ e.preventDefault(); selectInsurerOption(option); }
    });

    // Tabs y guardado pago
    payTabs.addEventListener('click',(e)=>{
      const tab = e.target.closest('.pay-tab'); if(!tab) return;
      document.querySelectorAll('.pay-tab').forEach(t=> t.classList.remove('active'));
      tab.classList.add('active');
      const method = tab.getAttribute('data-method');
      document.querySelectorAll('.pay-form').forEach(f=> f.style.display = f.getAttribute('data-method')===method ? 'block' : 'none');
    });

    document.getElementById('savePayment').addEventListener('click', ()=>{
      const activeTab = document.querySelector('.pay-tab.active');
      const method = activeTab?.getAttribute('data-method') || null;
      if(!method){ alert('Selecciona un método de pago.'); return; }

      if(method==='tarjeta'){
        const n = document.getElementById('cardNumber').value.replace(/\s+/g,'');
        const nm = document.getElementById('cardName').value.trim();
        const ex = document.getElementById('cardExp').value.trim();
        const cv = document.getElementById('cardCVV').value.trim();
        if(!nm || n.length<12 || !/^\d{2}\/\d{2}$/.test(ex) || cv.length<3){ alert('Completa los datos de la tarjeta correctamente.'); return; }
      }
      if(method==='pse'){
        if(!document.getElementById('pseBank').value || !document.getElementById('pseEmail').value){ alert('Selecciona banco e ingresa correo.'); return; }
      }

      selectedPayment.method = method;
      payHint.style.display = 'block';
      payMethodLabel.textContent = method.toUpperCase();
      paymentModal.style.display = 'none';
      showSuccess('Forma de pago guardada', `Método: ${method.toUpperCase()}`);
    });

    // Nueva póliza
    policyForm.addEventListener('submit',(e)=>{
      e.preventDefault();
      const insuredId = document.getElementById('insuredId').value;
      const insuredName = document.getElementById('insuredName').value;
      const insuranceType = document.getElementById('insuranceType').value;
      const coverageAmount = parseInt(document.getElementById('coverageAmount').value);
      const expirationDate = document.getElementById('expirationDate').value;
      const policyNumber = document.getElementById('policyNumber').value;
      const insurer = document.getElementById('insurer').value;
      const policyConditions = document.getElementById('policyConditions').value.trim();

      const newPolicy = {
        id: policies.length+1,
        type: insuranceType,
        typeName: document.getElementById('insuranceType').options[document.getElementById('insuranceType').selectedIndex].text,
        insurer,
        insurerName: insurerNames[insurer] || document.getElementById('insurer').options[document.getElementById('insurer').selectedIndex].text,
        policyNumber, expirationDate, insuredId, insuredName, coverage: coverageAmount,
        conditions: policyConditions || "Condiciones no especificadas."
      };
      policies.push(newPolicy);
      renderPolicies();
      policyModal.style.display='none';
      policyForm.reset();
      showSuccess("¡Póliza creada!", `Nueva póliza ${newPolicy.policyNumber} registrada correctamente.`);
    });

    // Renovación (+1 año exacto)
    confirmRenewalBtn.addEventListener('click', function(){
      const selected = document.querySelector('.insurer-option.selected');
      if(!selected){ alert('Por favor selecciona una aseguradora.'); return; }
      if(!selectedPayment.method){
        alert('Selecciona una forma de pago (se abre automáticamente al elegir la aseguradora).');
        paymentModal.style.display='flex';
        return;
      }

      const insurerKey = selected.getAttribute('data-insurer');

      if(currentRenewPolicyId != null){
        const idx = policies.findIndex(p => p.id === currentRenewPolicyId);
        if(idx !== -1){
          // +1 año exacto (evita 366)
          const newExpISO = formatDateISO(addYears(new Date(), 1));
          policies[idx].expirationDate = newExpISO;
          policies[idx].insurer = insurerKey;
          policies[idx].insurerName = insurerNames[insurerKey] || policies[idx].insurerName;

          renewalModal.style.display='none';
          renderPolicies();
          const msg = `Póliza ${policies[idx].policyNumber} renovada con ${insurerNames[insurerKey]}.`;
          const sub = `Nueva fecha de vencimiento: ${formatDateHuman(newExpISO)} · Pago: ${selectedPayment.method.toUpperCase()}.`;
          showSuccess("¡Renovación exitosa!", `${msg} ${sub}`);
        }
      }
      currentRenewPolicyId = null;
      selectedPayment = { method: null };
      payHint.style.display='none';
      payMethodLabel.textContent = '—';
    });

    // Inicio
    renderPolicies();
  </script>

  <!-- ===== Manifest y Service Worker en memoria, con guard de https/localhost ===== -->
  <script>
    (function createManifest(){
      // Sólo sirve plenamente bajo http(s). En file:// no es necesario.
      const manifest = {
        name: "InsuraHub",
        short_name: "InsuraHub",
        start_url: ".",
        scope: ".",
        display: "standalone",
        background_color: "#ffffff",
        theme_color: "#3498db",
        icons: [
          { "src": "icons/icon-192.png", "sizes": "192x192", "type": "image/png" },
          { "src": "icons/icon-512.png", "sizes": "512x512", "type": "image/png" }
        ]
      };
      const blob = new Blob([JSON.stringify(manifest)], {type: "application/manifest+json"});
      const url = URL.createObjectURL(blob);
      const link = document.createElement('link');
      link.rel = 'manifest';
      link.href = url;
      document.head.appendChild(link);
    })();

    // Registra un Service Worker generado por Blob, sólo en https o localhost (evita error de 'null origin')
    (function registerInlineSW(){
      if (!('serviceWorker' in navigator)) return;
      const isLocalhost = ['localhost','127.0.0.1','[::1]'].includes(location.hostname);
      const isSecure = location.protocol === 'https:' || isLocalhost;
      if (!isSecure) { console.warn('SW deshabilitado: usa https o localhost para activarlo.'); return; }

      const swCode = `
        const CACHE = 'insurahub-app-v1';
        const CORE = [ self.location.href ];
        self.addEventListener('install', e=>{
          e.waitUntil(caches.open(CACHE).then(c=>c.addAll(CORE)).then(()=>self.skipWaiting()));
        });
        self.addEventListener('activate', e=>{
          e.waitUntil(caches.keys().then(keys=>Promise.all(keys.map(k=>k===CACHE?null:caches.delete(k)))));
          self.clients.claim();
        });
        self.addEventListener('fetch', e=>{
          const req = e.request;
          e.respondWith(
            caches.match(req).then(r => r || fetch(req).then(res=>{
              if(req.method==='GET' && res.status===200){
                try{
                  const u = new URL(req.url);
                  if(u.origin===location.origin){
                    const copy = res.clone();
                    caches.open(CACHE).then(c=>c.put(req, copy));
                  }
                }catch(e){}
              }
              return res;
            }).catch(()=>caches.match(self.location.href)))
          );
        });
      `;
      const blob = new Blob([swCode], {type: 'text/javascript'});
      const swURL = URL.createObjectURL(blob);
      navigator.serviceWorker.register(swURL);
    })();
  </script>
</body>
</html>
